function cov_2mghcbs60a(){var path="/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/update-user.js";var hash="8da3e9a449a597bcb447e1d95e07cf6d748d2736";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/update-user.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:44}},"1":{start:{line:2,column:0},end:{line:2,column:42}},"2":{start:{line:3,column:0},end:{line:3,column:44}},"3":{start:{line:4,column:29},end:{line:4,column:56}},"4":{start:{line:5,column:59},end:{line:5,column:86}},"5":{start:{line:6,column:29},end:{line:6,column:53}},"6":{start:{line:7,column:15},end:{line:7,column:34}},"7":{start:{line:9,column:0},end:{line:43,column:1}},"8":{start:{line:11,column:4},end:{line:11,column:96}},"9":{start:{line:11,column:41},end:{line:11,column:96}},"10":{start:{line:12,column:4},end:{line:12,column:35}},"11":{start:{line:13,column:4},end:{line:17,column:5}},"12":{start:{line:14,column:8},end:{line:14,column:59}},"13":{start:{line:16,column:8},end:{line:16,column:50}},"14":{start:{line:19,column:4},end:{line:38,column:8}},"15":{start:{line:20,column:21},end:{line:20,column:48}},"16":{start:{line:21,column:8},end:{line:21,column:86}},"17":{start:{line:21,column:19},end:{line:21,column:86}},"18":{start:{line:23,column:45},end:{line:23,column:57}},"19":{start:{line:25,column:8},end:{line:28,column:61}},"20":{start:{line:26,column:26},end:{line:26,column:74}},"21":{start:{line:27,column:12},end:{line:27,column:68}},"22":{start:{line:27,column:24},end:{line:27,column:68}},"23":{start:{line:28,column:15},end:{line:28,column:61}},"24":{start:{line:30,column:8},end:{line:34,column:9}},"25":{start:{line:31,column:25},end:{line:31,column:59}},"26":{start:{line:32,column:12},end:{line:32,column:40}},"27":{start:{line:33,column:12},end:{line:33,column:76}},"28":{start:{line:36,column:8},end:{line:36,column:58}},"29":{start:{line:37,column:8},end:{line:37,column:14}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:17},end:{line:9,column:18}},loc:{start:{line:9,column:43},end:{line:43,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:19,column:12},end:{line:19,column:13}},loc:{start:{line:19,column:24},end:{line:38,column:5}},line:19}},branchMap:{"0":{loc:{start:{line:11,column:4},end:{line:11,column:96}},type:"if",locations:[{start:{line:11,column:4},end:{line:11,column:96}},{start:{line:11,column:4},end:{line:11,column:96}}],line:11},"1":{loc:{start:{line:14,column:8},end:{line:14,column:59}},type:"binary-expr",locations:[{start:{line:14,column:8},end:{line:14,column:23}},{start:{line:14,column:27},end:{line:14,column:59}}],line:14},"2":{loc:{start:{line:21,column:8},end:{line:21,column:86}},type:"if",locations:[{start:{line:21,column:8},end:{line:21,column:86}},{start:{line:21,column:8},end:{line:21,column:86}}],line:21},"3":{loc:{start:{line:25,column:8},end:{line:28,column:61}},type:"if",locations:[{start:{line:25,column:8},end:{line:28,column:61}},{start:{line:25,column:8},end:{line:28,column:61}}],line:25},"4":{loc:{start:{line:27,column:12},end:{line:27,column:68}},type:"if",locations:[{start:{line:27,column:12},end:{line:27,column:68}},{start:{line:27,column:12},end:{line:27,column:68}}],line:27},"5":{loc:{start:{line:30,column:8},end:{line:34,column:9}},type:"if",locations:[{start:{line:30,column:8},end:{line:34,column:9}},{start:{line:30,column:8},end:{line:34,column:9}}],line:30}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8da3e9a449a597bcb447e1d95e07cf6d748d2736"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2mghcbs60a=function(){return actualCoverage;};}return actualCoverage;}cov_2mghcbs60a();cov_2mghcbs60a().s[0]++;require('coohappy-commons/polyfills/string');cov_2mghcbs60a().s[1]++;require('coohappy-commons/polyfills/json');cov_2mghcbs60a().s[2]++;require('coohappy-commons/polyfills/number');const{utils:{Email}}=(cov_2mghcbs60a().s[3]++,require('coohappy-commons'));const{errors:{CredentialsError,UnexistenceError}}=(cov_2mghcbs60a().s[4]++,require('coohappy-commons'));const{models:{User}}=(cov_2mghcbs60a().s[5]++,require('coohappy-data'));const bcrypt=(cov_2mghcbs60a().s[6]++,require('bcryptjs'));cov_2mghcbs60a().s[7]++;module.exports=(userId,dataToUpdate)=>{cov_2mghcbs60a().f[0]++;cov_2mghcbs60a().s[8]++;if(typeof dataToUpdate!=='object'){cov_2mghcbs60a().b[0][0]++;cov_2mghcbs60a().s[9]++;throw new TypeError(`${dataToUpdate} is not an object`);}else{cov_2mghcbs60a().b[0][1]++;}cov_2mghcbs60a().s[10]++;String.validate.notVoid(userId);cov_2mghcbs60a().s[11]++;for(const key in dataToUpdate){cov_2mghcbs60a().s[12]++;(cov_2mghcbs60a().b[1][0]++,key==='email')&&(cov_2mghcbs60a().b[1][1]++,Email.isEmail(dataToUpdate[key]));cov_2mghcbs60a().s[13]++;String.validate.notVoid(dataToUpdate[key]);}cov_2mghcbs60a().s[14]++;return(async()=>{cov_2mghcbs60a().f[1]++;const user=(cov_2mghcbs60a().s[15]++,await User.findById(userId));cov_2mghcbs60a().s[16]++;if(!user){cov_2mghcbs60a().b[2][0]++;cov_2mghcbs60a().s[17]++;throw new UnexistenceError(`User with id ${userId} does not exist`);}else{cov_2mghcbs60a().b[2][1]++;}const{oldPassword,newPassword}=(cov_2mghcbs60a().s[18]++,dataToUpdate);cov_2mghcbs60a().s[19]++;if(typeof oldPassword!=='undefined'){cov_2mghcbs60a().b[3][0]++;const match=(cov_2mghcbs60a().s[20]++,await bcrypt.compare(oldPassword,user.password));cov_2mghcbs60a().s[21]++;if(!match){cov_2mghcbs60a().b[4][0]++;cov_2mghcbs60a().s[22]++;throw new CredentialsError(`Wrong password`);}else{cov_2mghcbs60a().b[4][1]++;}}else{cov_2mghcbs60a().b[3][1]++;cov_2mghcbs60a().s[23]++;throw new CredentialsError(`missing password`);}cov_2mghcbs60a().s[24]++;if(typeof newPassword!=='undefined'){cov_2mghcbs60a().b[5][0]++;const hash=(cov_2mghcbs60a().s[25]++,await bcrypt.hash(newPassword,10));cov_2mghcbs60a().s[26]++;dataToUpdate.password=hash;cov_2mghcbs60a().s[27]++;delete dataToUpdate.oldPassword,delete dataToUpdate.newPassword;}else{cov_2mghcbs60a().b[5][1]++;}cov_2mghcbs60a().s[28]++;await User.findByIdAndUpdate(userId,dataToUpdate);cov_2mghcbs60a().s[29]++;return;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVwZGF0ZS11c2VyLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJ1dGlscyIsIkVtYWlsIiwiZXJyb3JzIiwiQ3JlZGVudGlhbHNFcnJvciIsIlVuZXhpc3RlbmNlRXJyb3IiLCJtb2RlbHMiLCJVc2VyIiwiYmNyeXB0IiwibW9kdWxlIiwiZXhwb3J0cyIsInVzZXJJZCIsImRhdGFUb1VwZGF0ZSIsIlR5cGVFcnJvciIsIlN0cmluZyIsInZhbGlkYXRlIiwibm90Vm9pZCIsImtleSIsImlzRW1haWwiLCJ1c2VyIiwiZmluZEJ5SWQiLCJvbGRQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwibWF0Y2giLCJjb21wYXJlIiwicGFzc3dvcmQiLCJoYXNoIiwiZmluZEJ5SWRBbmRVcGRhdGUiXSwibWFwcGluZ3MiOiJnaElBZVk7bUhBZlpBLE9BQU8sQ0FBQyxtQ0FBRCxDQUFQLEMsd0JBQ0FBLE9BQU8sQ0FBQyxpQ0FBRCxDQUFQLEMsd0JBQ0FBLE9BQU8sQ0FBQyxtQ0FBRCxDQUFQLENBQ0EsS0FBTSxDQUFFQyxLQUFLLENBQUUsQ0FBRUMsS0FBRixDQUFULDJCQUF1QkYsT0FBTyxDQUFDLGtCQUFELENBQTlCLENBQU4sQ0FDQSxLQUFNLENBQUVHLE1BQU0sQ0FBRSxDQUFFQyxnQkFBRixDQUFvQkMsZ0JBQXBCLENBQVYsMkJBQXFETCxPQUFPLENBQUMsa0JBQUQsQ0FBNUQsQ0FBTixDQUNBLEtBQU0sQ0FBRU0sTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBViwyQkFBdUJQLE9BQU8sQ0FBQyxlQUFELENBQTlCLENBQU4sQ0FDQSxLQUFNUSxDQUFBQSxNQUFNLDBCQUFHUixPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQyx3QkFFQVMsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLE1BQUQsQ0FBU0MsWUFBVCxHQUEwQixpREFFdkMsR0FBRyxNQUFPQSxDQUFBQSxZQUFQLEdBQXdCLFFBQTNCLENBQXFDLHlEQUFNLElBQUlDLENBQUFBLFNBQUosQ0FBZSxHQUFFRCxZQUFhLG1CQUE5QixDQUFOLENBQXVELENBQTVGLGlDQUZ1Qyx5QkFHdkNFLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JMLE1BQXhCLEVBSHVDLHlCQUl2QyxJQUFLLEtBQU1NLENBQUFBLEdBQVgsR0FBa0JMLENBQUFBLFlBQWxCLENBQWdDLDBCQUM1Qiw0QkFBQUssR0FBRyxHQUFLLE9BQVIsK0JBQW1CZixLQUFLLENBQUNnQixPQUFOLENBQWNOLFlBQVksQ0FBQ0ssR0FBRCxDQUExQixDQUFuQixFQUQ0Qix5QkFHNUJILE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JKLFlBQVksQ0FBQ0ssR0FBRCxDQUFwQyxFQUNILENBUnNDLHlCQVV2QyxNQUFPLENBQUMsU0FBWSx5QkFDaEIsS0FBTUUsQ0FBQUEsSUFBSSwyQkFBRyxLQUFNWixDQUFBQSxJQUFJLENBQUNhLFFBQUwsQ0FBY1QsTUFBZCxDQUFULENBQVYsQ0FEZ0IseUJBRWhCLEdBQUksQ0FBQ1EsSUFBTCxDQUFXLDBEQUFNLElBQUlkLENBQUFBLGdCQUFKLENBQXNCLGdCQUFlTSxNQUFPLGlCQUE1QyxDQUFOLENBQW1FLENBQTlFLGlDQUVBLEtBQU0sQ0FBRVUsV0FBRixDQUFlQyxXQUFmLDRCQUErQlYsWUFBL0IsQ0FBTixDQUpnQix5QkFNaEIsR0FBSSxNQUFPUyxDQUFBQSxXQUFQLEdBQXVCLFdBQTNCLENBQXdDLDRCQUNwQyxLQUFNRSxDQUFBQSxLQUFLLDJCQUFHLEtBQU1mLENBQUFBLE1BQU0sQ0FBQ2dCLE9BQVAsQ0FBZUgsV0FBZixDQUE0QkYsSUFBSSxDQUFDTSxRQUFqQyxDQUFULENBQVgsQ0FEb0MseUJBRXBDLEdBQUksQ0FBQ0YsS0FBTCxDQUFZLDBEQUFNLElBQUluQixDQUFBQSxnQkFBSixDQUFzQixnQkFBdEIsQ0FBTixDQUE0QyxDQUF4RCxpQ0FDSCxDQUhELElBR08sMERBQU0sSUFBSUEsQ0FBQUEsZ0JBQUosQ0FBc0Isa0JBQXRCLENBQU4sQ0FBOEMsQ0FUckMseUJBV2hCLEdBQUksTUFBT2tCLENBQUFBLFdBQVAsR0FBdUIsV0FBM0IsQ0FBd0MsNEJBQ3BDLEtBQU1JLENBQUFBLElBQUksMkJBQUcsS0FBTWxCLENBQUFBLE1BQU0sQ0FBQ2tCLElBQVAsQ0FBWUosV0FBWixDQUF5QixFQUF6QixDQUFULENBQVYsQ0FEb0MseUJBRXBDVixZQUFZLENBQUNhLFFBQWIsQ0FBd0JDLElBQXhCLENBRm9DLHlCQUdwQyxNQUFPZCxDQUFBQSxZQUFZLENBQUNTLFdBQXBCLENBQWlDLE1BQU9ULENBQUFBLFlBQVksQ0FBQ1UsV0FBckQsQ0FDSCxDQUpELGlDQVhnQix5QkFpQmhCLEtBQU1mLENBQUFBLElBQUksQ0FBQ29CLGlCQUFMLENBQXVCaEIsTUFBdkIsQ0FBK0JDLFlBQS9CLENBQU4sQ0FqQmdCLHlCQWtCaEIsT0FDSCxDQW5CTSxHQUFQLENBd0JILENBbENEIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnY29vaGFwcHktY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcbnJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMvcG9seWZpbGxzL2pzb24nKVxucmVxdWlyZSgnY29vaGFwcHktY29tbW9ucy9wb2x5ZmlsbHMvbnVtYmVyJylcbmNvbnN0IHsgdXRpbHM6IHsgRW1haWwgfSB9ID0gcmVxdWlyZSgnY29vaGFwcHktY29tbW9ucycpXG5jb25zdCB7IGVycm9yczogeyBDcmVkZW50aWFsc0Vycm9yLCBVbmV4aXN0ZW5jZUVycm9yIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMnKVxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciB9IH0gPSByZXF1aXJlKCdjb29oYXBweS1kYXRhJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcblxubW9kdWxlLmV4cG9ydHMgPSAodXNlcklkLCBkYXRhVG9VcGRhdGUpID0+IHtcblxuICAgIGlmKHR5cGVvZiBkYXRhVG9VcGRhdGUgIT09ICdvYmplY3QnKSB0aHJvdyBuZXcgVHlwZUVycm9yKGAke2RhdGFUb1VwZGF0ZX0gaXMgbm90IGFuIG9iamVjdGApXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQodXNlcklkKVxuICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGFUb1VwZGF0ZSkge1xuICAgICAgICBrZXkgPT09ICdlbWFpbCcgJiYgRW1haWwuaXNFbWFpbChkYXRhVG9VcGRhdGVba2V5XSlcblxuICAgICAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChkYXRhVG9VcGRhdGVba2V5XSlcbiAgICB9XG5cbiAgICByZXR1cm4gKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlcklkKVxuICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGBVc2VyIHdpdGggaWQgJHt1c2VySWR9IGRvZXMgbm90IGV4aXN0YClcblxuICAgICAgICBjb25zdCB7IG9sZFBhc3N3b3JkLCBuZXdQYXNzd29yZCB9ID0gZGF0YVRvVXBkYXRlXG5cbiAgICAgICAgaWYgKHR5cGVvZiBvbGRQYXNzd29yZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUob2xkUGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpXG4gICAgICAgICAgICBpZiAoIW1hdGNoKSB0aHJvdyBuZXcgQ3JlZGVudGlhbHNFcnJvcihgV3JvbmcgcGFzc3dvcmRgKVxuICAgICAgICB9IGVsc2UgdGhyb3cgbmV3IENyZWRlbnRpYWxzRXJyb3IoYG1pc3NpbmcgcGFzc3dvcmRgKVxuXG4gICAgICAgIGlmICh0eXBlb2YgbmV3UGFzc3dvcmQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBjb25zdCBoYXNoID0gYXdhaXQgYmNyeXB0Lmhhc2gobmV3UGFzc3dvcmQsIDEwKVxuICAgICAgICAgICAgZGF0YVRvVXBkYXRlLnBhc3N3b3JkID0gaGFzaFxuICAgICAgICAgICAgZGVsZXRlIGRhdGFUb1VwZGF0ZS5vbGRQYXNzd29yZCwgZGVsZXRlIGRhdGFUb1VwZGF0ZS5uZXdQYXNzd29yZFxuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgVXNlci5maW5kQnlJZEFuZFVwZGF0ZSh1c2VySWQsIGRhdGFUb1VwZGF0ZSlcbiAgICAgICAgcmV0dXJuXG4gICAgfSkoKVxuXG5cblxuXG59Il19