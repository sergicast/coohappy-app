function cov_2o0lb8ua0d(){var path="/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/joinToCohousing.js";var hash="60fbd50817805c92cc87e8ea85dbca4e745aed9d";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/joinToCohousing.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:44}},"1":{start:{line:2,column:0},end:{line:2,column:42}},"2":{start:{line:3,column:57},end:{line:3,column:84}},"3":{start:{line:4,column:40},end:{line:4,column:64}},"4":{start:{line:5,column:35},end:{line:5,column:59}},"5":{start:{line:6,column:15},end:{line:6,column:34}},"6":{start:{line:9,column:0},end:{line:31,column:1}},"7":{start:{line:10,column:0},end:{line:10,column:31}},"8":{start:{line:11,column:4},end:{line:11,column:35}},"9":{start:{line:12,column:4},end:{line:12,column:39}},"10":{start:{line:14,column:4},end:{line:30,column:8}},"11":{start:{line:16,column:21},end:{line:16,column:48}},"12":{start:{line:17,column:8},end:{line:17,column:86}},"13":{start:{line:17,column:19},end:{line:17,column:86}},"14":{start:{line:19,column:27},end:{line:19,column:83}},"15":{start:{line:20,column:8},end:{line:20,column:105}},"16":{start:{line:20,column:24},end:{line:20,column:105}},"17":{start:{line:22,column:26},end:{line:22,column:77}},"18":{start:{line:23,column:8},end:{line:23,column:109}},"19":{start:{line:23,column:23},end:{line:23,column:109}},"20":{start:{line:24,column:8},end:{line:27,column:10}},"21":{start:{line:29,column:8},end:{line:29,column:15}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:17},end:{line:9,column:18}},loc:{start:{line:9,column:41},end:{line:31,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:12},end:{line:14,column:13}},loc:{start:{line:14,column:24},end:{line:30,column:5}},line:14}},branchMap:{"0":{loc:{start:{line:17,column:8},end:{line:17,column:86}},type:"if",locations:[{start:{line:17,column:8},end:{line:17,column:86}},{start:{line:17,column:8},end:{line:17,column:86}}],line:17},"1":{loc:{start:{line:20,column:8},end:{line:20,column:105}},type:"if",locations:[{start:{line:20,column:8},end:{line:20,column:105}},{start:{line:20,column:8},end:{line:20,column:105}}],line:20},"2":{loc:{start:{line:23,column:8},end:{line:23,column:109}},type:"if",locations:[{start:{line:23,column:8},end:{line:23,column:109}},{start:{line:23,column:8},end:{line:23,column:109}}],line:23}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"60fbd50817805c92cc87e8ea85dbca4e745aed9d"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2o0lb8ua0d=function(){return actualCoverage;};}return actualCoverage;}cov_2o0lb8ua0d();cov_2o0lb8ua0d().s[0]++;require('coohappy-commons/polyfills/string');cov_2o0lb8ua0d().s[1]++;require('coohappy-commons/polyfills/json');const{errors:{DuplicityError,UnexistenceError}}=(cov_2o0lb8ua0d().s[2]++,require('coohappy-commons'));const{models:{User,Cohousing}}=(cov_2o0lb8ua0d().s[3]++,require('coohappy-data'));const{mongoose:{ObjectId}}=(cov_2o0lb8ua0d().s[4]++,require('coohappy-data'));const bcrypt=(cov_2o0lb8ua0d().s[5]++,require('bcryptjs'));cov_2o0lb8ua0d().s[6]++;module.exports=(userId,accessCode)=>{cov_2o0lb8ua0d().f[0]++;cov_2o0lb8ua0d().s[7]++;console.log(userId,accessCode);cov_2o0lb8ua0d().s[8]++;String.validate.notVoid(userId);cov_2o0lb8ua0d().s[9]++;String.validate.notVoid(accessCode);cov_2o0lb8ua0d().s[10]++;return(async()=>{cov_2o0lb8ua0d().f[1]++;const user=(cov_2o0lb8ua0d().s[11]++,await User.findById(userId));cov_2o0lb8ua0d().s[12]++;if(!user){cov_2o0lb8ua0d().b[0][0]++;cov_2o0lb8ua0d().s[13]++;throw new UnexistenceError(`User with id ${userId} does not exist`);}else{cov_2o0lb8ua0d().b[0][1]++;}const _cohousing=(cov_2o0lb8ua0d().s[14]++,await Cohousing.findOne({'members':ObjectId(userId)}));cov_2o0lb8ua0d().s[15]++;if(_cohousing){cov_2o0lb8ua0d().b[1][0]++;cov_2o0lb8ua0d().s[16]++;throw new DuplicityError(`User with id ${userId} already belongs to a cohousing`);}else{cov_2o0lb8ua0d().b[1][1]++;}const cohousing=(cov_2o0lb8ua0d().s[17]++,await Cohousing.findOne({accessCode:accessCode}));cov_2o0lb8ua0d().s[18]++;if(!cohousing){cov_2o0lb8ua0d().b[2][0]++;cov_2o0lb8ua0d().s[19]++;throw new UnexistenceError(`cohousing with access code ${accessCode} does not exist `);}else{cov_2o0lb8ua0d().b[2][1]++;}cov_2o0lb8ua0d().s[20]++;await Promise.all([Cohousing.findByIdAndUpdate(cohousing.id,{$addToSet:{members:userId}}),User.findByIdAndUpdate(userId,{$set:{cohousing:cohousing._id}})]);cov_2o0lb8ua0d().s[21]++;return;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpvaW5Ub0NvaG91c2luZy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiZXJyb3JzIiwiRHVwbGljaXR5RXJyb3IiLCJVbmV4aXN0ZW5jZUVycm9yIiwibW9kZWxzIiwiVXNlciIsIkNvaG91c2luZyIsIm1vbmdvb3NlIiwiT2JqZWN0SWQiLCJiY3J5cHQiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwiYWNjZXNzQ29kZSIsImNvbnNvbGUiLCJsb2ciLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJ1c2VyIiwiZmluZEJ5SWQiLCJfY29ob3VzaW5nIiwiZmluZE9uZSIsImNvaG91c2luZyIsIlByb21pc2UiLCJhbGwiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsImlkIiwiJGFkZFRvU2V0IiwibWVtYmVycyIsIiRzZXQiLCJfaWQiXSwibWFwcGluZ3MiOiI4N0ZBZVk7bUhBZlpBLE9BQU8sQ0FBQyxtQ0FBRCxDQUFQLEMsd0JBQ0FBLE9BQU8sQ0FBQyxpQ0FBRCxDQUFQLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsY0FBRixDQUFrQkMsZ0JBQWxCLENBQVYsMkJBQW1ESCxPQUFPLENBQUMsa0JBQUQsQ0FBMUQsQ0FBTixDQUNBLEtBQU0sQ0FBRUksTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsU0FBUixDQUFWLDJCQUFrQ04sT0FBTyxDQUFDLGVBQUQsQ0FBekMsQ0FBTixDQUNBLEtBQU0sQ0FBRU8sUUFBUSxDQUFFLENBQUVDLFFBQUYsQ0FBWiwyQkFBNkJSLE9BQU8sQ0FBQyxlQUFELENBQXBDLENBQU4sQ0FDQSxLQUFNUyxDQUFBQSxNQUFNLDBCQUFHVCxPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQyx3QkFHQVUsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLE1BQUQsQ0FBU0MsVUFBVCxHQUF3QixpREFDekNDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSCxNQUFaLENBQW9CQyxVQUFwQixFQUR5Qyx3QkFFckNHLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JOLE1BQXhCLEVBRnFDLHdCQUdyQ0ksTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkwsVUFBeEIsRUFIcUMseUJBS3JDLE1BQU8sQ0FBQyxTQUFZLHlCQUVoQixLQUFNTSxDQUFBQSxJQUFJLDJCQUFHLEtBQU1kLENBQUFBLElBQUksQ0FBQ2UsUUFBTCxDQUFjUixNQUFkLENBQVQsQ0FBVixDQUZnQix5QkFHaEIsR0FBSSxDQUFDTyxJQUFMLENBQVcsMERBQU0sSUFBSWhCLENBQUFBLGdCQUFKLENBQXNCLGdCQUFlUyxNQUFPLGlCQUE1QyxDQUFOLENBQW1FLENBQTlFLGlDQUVBLEtBQU1TLENBQUFBLFVBQVUsMkJBQUcsS0FBTWYsQ0FBQUEsU0FBUyxDQUFDZ0IsT0FBVixDQUFrQixDQUFFLFVBQVdkLFFBQVEsQ0FBQ0ksTUFBRCxDQUFyQixDQUFsQixDQUFULENBQWhCLENBTGdCLHlCQU1oQixHQUFJUyxVQUFKLENBQWdCLDBEQUFNLElBQUluQixDQUFBQSxjQUFKLENBQW9CLGdCQUFlVSxNQUFPLGlDQUExQyxDQUFOLENBQWlGLENBQWpHLGlDQUVBLEtBQU1XLENBQUFBLFNBQVMsMkJBQUcsS0FBTWpCLENBQUFBLFNBQVMsQ0FBQ2dCLE9BQVYsQ0FBa0IsQ0FBRVQsVUFBVSxDQUFFQSxVQUFkLENBQWxCLENBQVQsQ0FBZixDQVJnQix5QkFTaEIsR0FBRyxDQUFDVSxTQUFKLENBQWUsMERBQU0sSUFBSXBCLENBQUFBLGdCQUFKLENBQXNCLDhCQUE2QlUsVUFBVyxrQkFBOUQsQ0FBTixDQUFzRixDQUFyRyxpQ0FUZ0IseUJBVWhCLEtBQU1XLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLENBQ2RuQixTQUFTLENBQUNvQixpQkFBVixDQUE0QkgsU0FBUyxDQUFDSSxFQUF0QyxDQUEwQyxDQUFFQyxTQUFTLENBQUUsQ0FBRUMsT0FBTyxDQUFFakIsTUFBWCxDQUFiLENBQTFDLENBRGMsQ0FFZFAsSUFBSSxDQUFDcUIsaUJBQUwsQ0FBdUJkLE1BQXZCLENBQStCLENBQUVrQixJQUFJLENBQUUsQ0FBRVAsU0FBUyxDQUFFQSxTQUFTLENBQUNRLEdBQXZCLENBQVIsQ0FBL0IsQ0FGYyxDQUFaLENBQU4sQ0FWZ0IseUJBZWhCLE9BQ0gsQ0FoQk0sR0FBUCxDQWlCSCxDQXRCRCIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMvcG9seWZpbGxzL3N0cmluZycpXG5yZXF1aXJlKCdjb29oYXBweS1jb21tb25zL3BvbHlmaWxscy9qc29uJylcbmNvbnN0IHsgZXJyb3JzOiB7IER1cGxpY2l0eUVycm9yLCBVbmV4aXN0ZW5jZUVycm9yIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMnKVxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciwgQ29ob3VzaW5nIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWRhdGEnKVxuY29uc3QgeyBtb25nb29zZTogeyBPYmplY3RJZCB9IH0gPSByZXF1aXJlKCdjb29oYXBweS1kYXRhJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcblxuXG5tb2R1bGUuZXhwb3J0cyA9ICh1c2VySWQsIGFjY2Vzc0NvZGUpID0+IHtcbmNvbnNvbGUubG9nKHVzZXJJZCwgYWNjZXNzQ29kZSlcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZCh1c2VySWQpXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQoYWNjZXNzQ29kZSlcblxuICAgIHJldHVybiAoYXN5bmMgKCkgPT4ge1xuXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZClcbiAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgVW5leGlzdGVuY2VFcnJvcihgVXNlciB3aXRoIGlkICR7dXNlcklkfSBkb2VzIG5vdCBleGlzdGApXG4gICAgICAgXG4gICAgICAgIGNvbnN0IF9jb2hvdXNpbmcgPSBhd2FpdCBDb2hvdXNpbmcuZmluZE9uZSh7ICdtZW1iZXJzJzogT2JqZWN0SWQodXNlcklkKSB9KVxuICAgICAgICBpZiAoX2NvaG91c2luZykgdGhyb3cgbmV3IER1cGxpY2l0eUVycm9yKGBVc2VyIHdpdGggaWQgJHt1c2VySWR9IGFscmVhZHkgYmVsb25ncyB0byBhIGNvaG91c2luZ2ApXG5cbiAgICAgICAgY29uc3QgY29ob3VzaW5nID0gYXdhaXQgQ29ob3VzaW5nLmZpbmRPbmUoeyBhY2Nlc3NDb2RlOiBhY2Nlc3NDb2RlIH0pXG4gICAgICAgIGlmKCFjb2hvdXNpbmcpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGBjb2hvdXNpbmcgd2l0aCBhY2Nlc3MgY29kZSAke2FjY2Vzc0NvZGV9IGRvZXMgbm90IGV4aXN0IGApXG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIENvaG91c2luZy5maW5kQnlJZEFuZFVwZGF0ZShjb2hvdXNpbmcuaWQsIHsgJGFkZFRvU2V0OiB7IG1lbWJlcnM6IHVzZXJJZCB9IH0pLFxuICAgICAgICAgICAgVXNlci5maW5kQnlJZEFuZFVwZGF0ZSh1c2VySWQsIHsgJHNldDogeyBjb2hvdXNpbmc6IGNvaG91c2luZy5faWQgfSB9KVxuICAgICAgICBdKVxuXG4gICAgICAgIHJldHVybjtcbiAgICB9KSgpXG59Il19