function cov_1yjuzwa3b8(){var path="/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/register-cohousing.js";var hash="54a4426a123d4dca32a7ed6ad09e3b451c74d733";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/register-cohousing.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:44}},"1":{start:{line:2,column:0},end:{line:2,column:42}},"2":{start:{line:3,column:57},end:{line:3,column:84}},"3":{start:{line:4,column:40},end:{line:4,column:64}},"4":{start:{line:5,column:40},end:{line:5,column:67}},"5":{start:{line:8,column:0},end:{line:31,column:1}},"6":{start:{line:9,column:4},end:{line:9,column:33}},"7":{start:{line:10,column:4},end:{line:10,column:87}},"8":{start:{line:10,column:37},end:{line:10,column:87}},"9":{start:{line:11,column:4},end:{line:11,column:35}},"10":{start:{line:12,column:20},end:{line:12,column:22}},"11":{start:{line:14,column:4},end:{line:30,column:8}},"12":{start:{line:15,column:34},end:{line:18,column:10}},"13":{start:{line:20,column:8},end:{line:20,column:113}},"14":{start:{line:20,column:23},end:{line:20,column:113}},"15":{start:{line:21,column:8},end:{line:21,column:69}},"16":{start:{line:21,column:19},end:{line:21,column:69}},"17":{start:{line:23,column:27},end:{line:23,column:49}},"18":{start:{line:25,column:8},end:{line:25,column:26}},"19":{start:{line:27,column:29},end:{line:27,column:117}},"20":{start:{line:29,column:8},end:{line:29,column:75}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:17},end:{line:8,column:18}},loc:{start:{line:8,column:56},end:{line:31,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:12},end:{line:14,column:13}},loc:{start:{line:14,column:24},end:{line:30,column:5}},line:14}},branchMap:{"0":{loc:{start:{line:10,column:4},end:{line:10,column:87}},type:"if",locations:[{start:{line:10,column:4},end:{line:10,column:87}},{start:{line:10,column:4},end:{line:10,column:87}}],line:10},"1":{loc:{start:{line:20,column:8},end:{line:20,column:113}},type:"if",locations:[{start:{line:20,column:8},end:{line:20,column:113}},{start:{line:20,column:8},end:{line:20,column:113}}],line:20},"2":{loc:{start:{line:21,column:8},end:{line:21,column:69}},type:"if",locations:[{start:{line:21,column:8},end:{line:21,column:69}},{start:{line:21,column:8},end:{line:21,column:69}}],line:21}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"54a4426a123d4dca32a7ed6ad09e3b451c74d733"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1yjuzwa3b8=function(){return actualCoverage;};}return actualCoverage;}cov_1yjuzwa3b8();cov_1yjuzwa3b8().s[0]++;require('coohappy-commons/polyfills/string');cov_1yjuzwa3b8().s[1]++;require('coohappy-commons/polyfills/json');const{errors:{UnexistenceError,DuplicityError}}=(cov_1yjuzwa3b8().s[2]++,require('coohappy-commons'));const{models:{Cohousing,User}}=(cov_1yjuzwa3b8().s[3]++,require('coohappy-data'));const{utils:{randomAccessCode}}=(cov_1yjuzwa3b8().s[4]++,require('coohappy-commons'));cov_1yjuzwa3b8().s[5]++;module.exports=(name,address,laundryNum,userId)=>{cov_1yjuzwa3b8().f[0]++;cov_1yjuzwa3b8().s[6]++;String.validate.notVoid(name);cov_1yjuzwa3b8().s[7]++;if(typeof address!=='object'){cov_1yjuzwa3b8().b[0][0]++;cov_1yjuzwa3b8().s[8]++;throw new TypeError(`${address} is not an object`);}else{cov_1yjuzwa3b8().b[0][1]++;}cov_1yjuzwa3b8().s[9]++;String.validate.notVoid(userId);const members=(cov_1yjuzwa3b8().s[10]++,[]);cov_1yjuzwa3b8().s[11]++;return(async()=>{cov_1yjuzwa3b8().f[1]++;const[user,cohousing]=(cov_1yjuzwa3b8().s[12]++,await Promise.all([User.findById(userId),Cohousing.findOne({author:userId})]));cov_1yjuzwa3b8().s[13]++;if(cohousing){cov_1yjuzwa3b8().b[1][0]++;cov_1yjuzwa3b8().s[14]++;throw new DuplicityError(`user: ${user.name} ${user.surname} already create an cohousing`);}else{cov_1yjuzwa3b8().b[1][1]++;}cov_1yjuzwa3b8().s[15]++;if(!user){cov_1yjuzwa3b8().b[2][0]++;cov_1yjuzwa3b8().s[16]++;throw new UnexistenceError(`user does not exists`);}else{cov_1yjuzwa3b8().b[2][1]++;}const accessCode=(cov_1yjuzwa3b8().s[17]++,randomAccessCode(name));cov_1yjuzwa3b8().s[18]++;members.push(user);const newCohousing=(cov_1yjuzwa3b8().s[19]++,await Cohousing.create({author:userId,name,address,laundryNum,members,accessCode}));cov_1yjuzwa3b8().s[20]++;await User.updateOne({role:'admin',cohousing:newCohousing._id});})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLWNvaG91c2luZy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiZXJyb3JzIiwiVW5leGlzdGVuY2VFcnJvciIsIkR1cGxpY2l0eUVycm9yIiwibW9kZWxzIiwiQ29ob3VzaW5nIiwiVXNlciIsInV0aWxzIiwicmFuZG9tQWNjZXNzQ29kZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJuYW1lIiwiYWRkcmVzcyIsImxhdW5kcnlOdW0iLCJ1c2VySWQiLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJUeXBlRXJyb3IiLCJtZW1iZXJzIiwidXNlciIsImNvaG91c2luZyIsIlByb21pc2UiLCJhbGwiLCJmaW5kQnlJZCIsImZpbmRPbmUiLCJhdXRob3IiLCJzdXJuYW1lIiwiYWNjZXNzQ29kZSIsInB1c2giLCJuZXdDb2hvdXNpbmciLCJjcmVhdGUiLCJ1cGRhdGVPbmUiLCJyb2xlIiwiX2lkIl0sIm1hcHBpbmdzIjoiaTRGQWVZO21IQWZaQSxPQUFPLENBQUMsbUNBQUQsQ0FBUCxDLHdCQUNBQSxPQUFPLENBQUMsaUNBQUQsQ0FBUCxDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLGdCQUFGLENBQW9CQyxjQUFwQixDQUFWLDJCQUFtREgsT0FBTyxDQUFDLGtCQUFELENBQTFELENBQU4sQ0FDQSxLQUFNLENBQUVJLE1BQU0sQ0FBRSxDQUFFQyxTQUFGLENBQWFDLElBQWIsQ0FBViwyQkFBa0NOLE9BQU8sQ0FBQyxlQUFELENBQXpDLENBQU4sQ0FDQSxLQUFNLENBQUVPLEtBQUssQ0FBRSxDQUFFQyxnQkFBRixDQUFULDJCQUFrQ1IsT0FBTyxDQUFDLGtCQUFELENBQXpDLENBQU4sQyx3QkFHQVMsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLElBQUQsQ0FBT0MsT0FBUCxDQUFnQkMsVUFBaEIsQ0FBNEJDLE1BQTVCLEdBQXVDLGlEQUNwREMsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3Qk4sSUFBeEIsRUFEb0Qsd0JBRXBELEdBQUksTUFBT0MsQ0FBQUEsT0FBUCxHQUFtQixRQUF2QixDQUFpQyx5REFBTSxJQUFJTSxDQUFBQSxTQUFKLENBQWUsR0FBRU4sT0FBUSxtQkFBekIsQ0FBTixDQUFrRCxDQUFuRixpQ0FGb0Qsd0JBR3BERyxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSCxNQUF4QixFQUNBLEtBQU1LLENBQUFBLE9BQU8sMkJBQUcsRUFBSCxDQUFiLENBSm9ELHlCQU1wRCxNQUFPLENBQUMsU0FBWSx5QkFDaEIsS0FBTSxDQUFDQyxJQUFELENBQU9DLFNBQVAsNEJBQW9CLEtBQU1DLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLENBQ3hDakIsSUFBSSxDQUFDa0IsUUFBTCxDQUFjVixNQUFkLENBRHdDLENBRXhDVCxTQUFTLENBQUNvQixPQUFWLENBQWtCLENBQUVDLE1BQU0sQ0FBRVosTUFBVixDQUFsQixDQUZ3QyxDQUFaLENBQTFCLENBQU4sQ0FEZ0IseUJBTWhCLEdBQUlPLFNBQUosQ0FBZSwwREFBTSxJQUFJbEIsQ0FBQUEsY0FBSixDQUFvQixTQUFRaUIsSUFBSSxDQUFDVCxJQUFLLElBQUdTLElBQUksQ0FBQ08sT0FBUSw4QkFBdEQsQ0FBTixDQUEwRixDQUF6RyxpQ0FOZ0IseUJBT2hCLEdBQUksQ0FBQ1AsSUFBTCxDQUFXLDBEQUFNLElBQUlsQixDQUFBQSxnQkFBSixDQUFzQixzQkFBdEIsQ0FBTixDQUFrRCxDQUE3RCxpQ0FFQSxLQUFNMEIsQ0FBQUEsVUFBVSwyQkFBR3BCLGdCQUFnQixDQUFDRyxJQUFELENBQW5CLENBQWhCLENBVGdCLHlCQVdoQlEsT0FBTyxDQUFDVSxJQUFSLENBQWFULElBQWIsRUFFQSxLQUFNVSxDQUFBQSxZQUFZLDJCQUFHLEtBQU16QixDQUFBQSxTQUFTLENBQUMwQixNQUFWLENBQWlCLENBQUVMLE1BQU0sQ0FBRVosTUFBVixDQUFrQkgsSUFBbEIsQ0FBd0JDLE9BQXhCLENBQWdDQyxVQUFoQyxDQUE0Q00sT0FBNUMsQ0FBcURTLFVBQXJELENBQWpCLENBQVQsQ0FBbEIsQ0FiZ0IseUJBZWhCLEtBQU10QixDQUFBQSxJQUFJLENBQUMwQixTQUFMLENBQWUsQ0FBRUMsSUFBSSxDQUFFLE9BQVIsQ0FBaUJaLFNBQVMsQ0FBRVMsWUFBWSxDQUFDSSxHQUF6QyxDQUFmLENBQU4sQ0FDSCxDQWhCTSxHQUFQLENBaUJILENBdkJEIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnY29vaGFwcHktY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcbnJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMvcG9seWZpbGxzL2pzb24nKVxuY29uc3QgeyBlcnJvcnM6IHsgVW5leGlzdGVuY2VFcnJvciwgRHVwbGljaXR5RXJyb3IgfSB9ID0gcmVxdWlyZSgnY29vaGFwcHktY29tbW9ucycpXG5jb25zdCB7IG1vZGVsczogeyBDb2hvdXNpbmcsIFVzZXIgfSB9ID0gcmVxdWlyZSgnY29vaGFwcHktZGF0YScpXG5jb25zdCB7IHV0aWxzOiB7IHJhbmRvbUFjY2Vzc0NvZGUgfSB9ID0gcmVxdWlyZSgnY29vaGFwcHktY29tbW9ucycpXG5cblxubW9kdWxlLmV4cG9ydHMgPSAobmFtZSwgYWRkcmVzcywgbGF1bmRyeU51bSwgdXNlcklkKSA9PiB7XG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQobmFtZSlcbiAgICBpZiAodHlwZW9mIGFkZHJlc3MgIT09ICdvYmplY3QnKSB0aHJvdyBuZXcgVHlwZUVycm9yKGAke2FkZHJlc3N9IGlzIG5vdCBhbiBvYmplY3RgKVxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKHVzZXJJZClcbiAgICBjb25zdCBtZW1iZXJzID0gW11cblxuICAgIHJldHVybiAoYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBbdXNlciwgY29ob3VzaW5nXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIFVzZXIuZmluZEJ5SWQodXNlcklkKSxcbiAgICAgICAgICAgIENvaG91c2luZy5maW5kT25lKHsgYXV0aG9yOiB1c2VySWQgfSlcbiAgICAgICAgXSlcblxuICAgICAgICBpZiAoY29ob3VzaW5nKSB0aHJvdyBuZXcgRHVwbGljaXR5RXJyb3IoYHVzZXI6ICR7dXNlci5uYW1lfSAke3VzZXIuc3VybmFtZX0gYWxyZWFkeSBjcmVhdGUgYW4gY29ob3VzaW5nYClcbiAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgVW5leGlzdGVuY2VFcnJvcihgdXNlciBkb2VzIG5vdCBleGlzdHNgKVxuXG4gICAgICAgIGNvbnN0IGFjY2Vzc0NvZGUgPSByYW5kb21BY2Nlc3NDb2RlKG5hbWUpXG5cbiAgICAgICAgbWVtYmVycy5wdXNoKHVzZXIpXG5cbiAgICAgICAgY29uc3QgbmV3Q29ob3VzaW5nID0gYXdhaXQgQ29ob3VzaW5nLmNyZWF0ZSh7IGF1dGhvcjogdXNlcklkLCBuYW1lLCBhZGRyZXNzLGxhdW5kcnlOdW0sIG1lbWJlcnMsIGFjY2Vzc0NvZGV9KVxuXG4gICAgICAgIGF3YWl0IFVzZXIudXBkYXRlT25lKHsgcm9sZTogJ2FkbWluJywgY29ob3VzaW5nOiBuZXdDb2hvdXNpbmcuX2lkfSlcbiAgICB9KSgpXG59Il19