function cov_3lui2z1d8(){var path="/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/add-date-laundry.js";var hash="2ba80685b8c583aa9577b4644c4a9e99de7c383a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/add-date-laundry.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:44}},"1":{start:{line:2,column:0},end:{line:2,column:42}},"2":{start:{line:3,column:57},end:{line:3,column:84}},"3":{start:{line:4,column:34},end:{line:4,column:58}},"4":{start:{line:5,column:35},end:{line:5,column:59}},"5":{start:{line:7,column:0},end:{line:36,column:1}},"6":{start:{line:9,column:4},end:{line:9,column:35}},"7":{start:{line:10,column:4},end:{line:10,column:32}},"8":{start:{line:11,column:4},end:{line:11,column:33}},"9":{start:{line:13,column:4},end:{line:35,column:8}},"10":{start:{line:15,column:26},end:{line:15,column:89}},"11":{start:{line:16,column:8},end:{line:16,column:108}},"12":{start:{line:16,column:24},end:{line:16,column:108}},"13":{start:{line:17,column:28},end:{line:17,column:37}},"14":{start:{line:18,column:34},end:{line:21,column:10}},"15":{start:{line:20,column:12},end:{line:20,column:63}},"16":{start:{line:23,column:8},end:{line:33,column:9}},"17":{start:{line:25,column:12},end:{line:30,column:13}},"18":{start:{line:25,column:61},end:{line:25,column:88}},"19":{start:{line:26,column:16},end:{line:26,column:128}},"20":{start:{line:29,column:16},end:{line:29,column:91}},"21":{start:{line:32,column:12},end:{line:32,column:80}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:17},end:{line:7,column:18}},loc:{start:{line:7,column:40},end:{line:36,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:13,column:12},end:{line:13,column:13}},loc:{start:{line:13,column:24},end:{line:35,column:5}},line:13},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:49},end:{line:18,column:50}},loc:{start:{line:18,column:60},end:{line:21,column:9}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:25,column:40},end:{line:25,column:41}},loc:{start:{line:25,column:61},end:{line:25,column:88}},line:25}},branchMap:{"0":{loc:{start:{line:16,column:8},end:{line:16,column:108}},type:"if",locations:[{start:{line:16,column:8},end:{line:16,column:108}},{start:{line:16,column:8},end:{line:16,column:108}}],line:16},"1":{loc:{start:{line:20,column:19},end:{line:20,column:63}},type:"binary-expr",locations:[{start:{line:20,column:19},end:{line:20,column:38}},{start:{line:20,column:42},end:{line:20,column:63}}],line:20},"2":{loc:{start:{line:23,column:8},end:{line:33,column:9}},type:"if",locations:[{start:{line:23,column:8},end:{line:33,column:9}},{start:{line:23,column:8},end:{line:33,column:9}}],line:23},"3":{loc:{start:{line:23,column:12},end:{line:23,column:93}},type:"binary-expr",locations:[{start:{line:23,column:12},end:{line:23,column:42}},{start:{line:23,column:46},end:{line:23,column:93}}],line:23},"4":{loc:{start:{line:25,column:12},end:{line:30,column:13}},type:"if",locations:[{start:{line:25,column:12},end:{line:30,column:13}},{start:{line:25,column:12},end:{line:30,column:13}}],line:25}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2ba80685b8c583aa9577b4644c4a9e99de7c383a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_3lui2z1d8=function(){return actualCoverage;};}return actualCoverage;}cov_3lui2z1d8();cov_3lui2z1d8().s[0]++;require('coohappy-commons/polyfills/string');cov_3lui2z1d8().s[1]++;require('coohappy-commons/polyfills/json');const{errors:{UnexistenceError,DuplicityError}}=(cov_3lui2z1d8().s[2]++,require('coohappy-commons'));const{models:{Cohousing}}=(cov_3lui2z1d8().s[3]++,require('coohappy-data'));const{mongoose:{ObjectId}}=(cov_3lui2z1d8().s[4]++,require('coohappy-data'));cov_3lui2z1d8().s[5]++;module.exports=(day,hour,userId)=>{cov_3lui2z1d8().f[0]++;cov_3lui2z1d8().s[6]++;String.validate.notVoid(userId);cov_3lui2z1d8().s[7]++;String.validate.notVoid(day);cov_3lui2z1d8().s[8]++;String.validate.notVoid(hour);cov_3lui2z1d8().s[9]++;return(async()=>{cov_3lui2z1d8().f[1]++;const cohousing=(cov_3lui2z1d8().s[10]++,await Cohousing.findOne({'members':ObjectId(userId)}).lean());cov_3lui2z1d8().s[11]++;if(!cohousing){cov_3lui2z1d8().b[0][0]++;cov_3lui2z1d8().s[12]++;throw new UnexistenceError(`There is no cohousing with a user with an id ${userId}`);}else{cov_3lui2z1d8().b[0][1]++;}const{laundry}=(cov_3lui2z1d8().s[13]++,cohousing);const amountOfLaundries=(cov_3lui2z1d8().s[14]++,laundry.filter(laundry=>{cov_3lui2z1d8().f[2]++;cov_3lui2z1d8().s[15]++;return(cov_3lui2z1d8().b[1][0]++,laundry.day===day)&&(cov_3lui2z1d8().b[1][1]++,laundry.hour===hour);}));cov_3lui2z1d8().s[16]++;if((cov_3lui2z1d8().b[3][0]++,amountOfLaundries.length===0)||(cov_3lui2z1d8().b[3][1]++,amountOfLaundries.length<cohousing.laundryNum)){cov_3lui2z1d8().b[2][0]++;cov_3lui2z1d8().s[17]++;if(!cohousing.laundry.some(({user:_user})=>{cov_3lui2z1d8().f[3]++;cov_3lui2z1d8().s[18]++;return _user.toString()===userId;})){cov_3lui2z1d8().b[4][0]++;cov_3lui2z1d8().s[19]++;await Cohousing.findOneAndUpdate({'members':userId},{$addToSet:{laundry:{day,hour,user:userId}}});}else{cov_3lui2z1d8().b[4][1]++;cov_3lui2z1d8().s[20]++;throw new DuplicityError(`You already have a reservation, can only do one`);}}else{cov_3lui2z1d8().b[2][1]++;cov_3lui2z1d8().s[21]++;throw new DuplicityError('sorry all the washing machines are full ');}})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZC1kYXRlLWxhdW5kcnkuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsImVycm9ycyIsIlVuZXhpc3RlbmNlRXJyb3IiLCJEdXBsaWNpdHlFcnJvciIsIm1vZGVscyIsIkNvaG91c2luZyIsIm1vbmdvb3NlIiwiT2JqZWN0SWQiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGF5IiwiaG91ciIsInVzZXJJZCIsIlN0cmluZyIsInZhbGlkYXRlIiwibm90Vm9pZCIsImNvaG91c2luZyIsImZpbmRPbmUiLCJsZWFuIiwibGF1bmRyeSIsImFtb3VudE9mTGF1bmRyaWVzIiwiZmlsdGVyIiwibGVuZ3RoIiwibGF1bmRyeU51bSIsInNvbWUiLCJ1c2VyIiwiX3VzZXIiLCJ0b1N0cmluZyIsImZpbmRPbmVBbmRVcGRhdGUiLCIkYWRkVG9TZXQiXSwibWFwcGluZ3MiOiI4cEhBZVk7Z0hBZlpBLE9BQU8sQ0FBQyxtQ0FBRCxDQUFQLEMsdUJBQ0FBLE9BQU8sQ0FBQyxpQ0FBRCxDQUFQLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsZ0JBQUYsQ0FBb0JDLGNBQXBCLENBQVYsMEJBQW1ESCxPQUFPLENBQUMsa0JBQUQsQ0FBMUQsQ0FBTixDQUNBLEtBQU0sQ0FBRUksTUFBTSxDQUFFLENBQUVDLFNBQUYsQ0FBViwwQkFBNEJMLE9BQU8sQ0FBQyxlQUFELENBQW5DLENBQU4sQ0FDQSxLQUFNLENBQUVNLFFBQVEsQ0FBRSxDQUFFQyxRQUFGLENBQVosMEJBQTZCUCxPQUFPLENBQUMsZUFBRCxDQUFwQyxDQUFOLEMsdUJBRUFRLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxHQUFELENBQU1DLElBQU4sQ0FBWUMsTUFBWixHQUF1QiwrQ0FFcENDLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JILE1BQXhCLEVBRm9DLHVCQUdwQ0MsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkwsR0FBeEIsRUFIb0MsdUJBSXBDRyxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSixJQUF4QixFQUpvQyx1QkFNcEMsTUFBTyxDQUFDLFNBQVksd0JBRWhCLEtBQU1LLENBQUFBLFNBQVMsMEJBQUcsS0FBTVgsQ0FBQUEsU0FBUyxDQUFDWSxPQUFWLENBQWtCLENBQUUsVUFBV1YsUUFBUSxDQUFDSyxNQUFELENBQXJCLENBQWxCLEVBQW1ETSxJQUFuRCxFQUFULENBQWYsQ0FGZ0Isd0JBR2hCLEdBQUksQ0FBQ0YsU0FBTCxDQUFnQix3REFBTSxJQUFJZCxDQUFBQSxnQkFBSixDQUFzQixnREFBK0NVLE1BQU8sRUFBNUUsQ0FBTixDQUFvRixDQUFwRyxnQ0FDQSxLQUFNLENBQUVPLE9BQUYsMkJBQWNILFNBQWQsQ0FBTixDQUNBLEtBQU1JLENBQUFBLGlCQUFpQiwwQkFBR0QsT0FBTyxDQUFDRSxNQUFSLENBQWVGLE9BQU8sRUFBSSxnREFFaEQsTUFBTywyQkFBQUEsT0FBTyxDQUFDVCxHQUFSLEdBQWdCQSxHQUFoQiw4QkFBdUJTLE9BQU8sQ0FBQ1IsSUFBUixHQUFpQkEsSUFBeEMsQ0FBUCxDQUNILENBSHlCLENBQUgsQ0FBdkIsQ0FMZ0Isd0JBVWhCLEdBQUksMkJBQUFTLGlCQUFpQixDQUFDRSxNQUFsQixHQUE2QixDQUE3Qiw4QkFBa0NGLGlCQUFpQixDQUFDRSxNQUFsQixDQUEyQk4sU0FBUyxDQUFDTyxVQUF2RSxDQUFKLENBQXVGLG1EQUVuRixHQUFJLENBQUNQLFNBQVMsQ0FBQ0csT0FBVixDQUFrQkssSUFBbEIsQ0FBdUIsQ0FBQyxDQUFFQyxJQUFJLENBQUVDLEtBQVIsQ0FBRCxHQUFxQixzREFBQUEsQ0FBQUEsS0FBSyxDQUFDQyxRQUFOLEtBQXFCZixNQUFyQixDQUEyQixDQUF2RSxDQUFMLENBQStFLG1EQUMzRSxLQUFNUCxDQUFBQSxTQUFTLENBQUN1QixnQkFBVixDQUEyQixDQUFFLFVBQVdoQixNQUFiLENBQTNCLENBQWtELENBQUVpQixTQUFTLENBQUUsQ0FBRVYsT0FBTyxDQUFFLENBQUVULEdBQUYsQ0FBT0MsSUFBUCxDQUFhYyxJQUFJLENBQUViLE1BQW5CLENBQVgsQ0FBYixDQUFsRCxDQUFOLENBRUgsQ0FIRCxJQUdPLG1EQUNILEtBQU0sSUFBSVQsQ0FBQUEsY0FBSixDQUFvQixpREFBcEIsQ0FBTixDQUNILENBQ0osQ0FSRCxJQVFPLG1EQUNILEtBQU0sSUFBSUEsQ0FBQUEsY0FBSixDQUFtQiwwQ0FBbkIsQ0FBTixDQUNILENBRUosQ0F0Qk0sR0FBUCxDQXVCSCxDQTdCRCIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMvcG9seWZpbGxzL3N0cmluZycpXG5yZXF1aXJlKCdjb29oYXBweS1jb21tb25zL3BvbHlmaWxscy9qc29uJylcbmNvbnN0IHsgZXJyb3JzOiB7IFVuZXhpc3RlbmNlRXJyb3IsIER1cGxpY2l0eUVycm9yIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMnKVxuY29uc3QgeyBtb2RlbHM6IHsgQ29ob3VzaW5nIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWRhdGEnKVxuY29uc3QgeyBtb25nb29zZTogeyBPYmplY3RJZCB9IH0gPSByZXF1aXJlKCdjb29oYXBweS1kYXRhJylcblxubW9kdWxlLmV4cG9ydHMgPSAoZGF5LCBob3VyLCB1c2VySWQpID0+IHtcblxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKHVzZXJJZClcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChkYXkpXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQoaG91cilcblxuICAgIHJldHVybiAoYXN5bmMgKCkgPT4ge1xuXG4gICAgICAgIGNvbnN0IGNvaG91c2luZyA9IGF3YWl0IENvaG91c2luZy5maW5kT25lKHsgJ21lbWJlcnMnOiBPYmplY3RJZCh1c2VySWQpIH0pLmxlYW4oKVxuICAgICAgICBpZiAoIWNvaG91c2luZykgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYFRoZXJlIGlzIG5vIGNvaG91c2luZyB3aXRoIGEgdXNlciB3aXRoIGFuIGlkICR7dXNlcklkfWApXG4gICAgICAgIGNvbnN0IHsgbGF1bmRyeSB9ID0gY29ob3VzaW5nXG4gICAgICAgIGNvbnN0IGFtb3VudE9mTGF1bmRyaWVzID0gbGF1bmRyeS5maWx0ZXIobGF1bmRyeSA9PiB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBsYXVuZHJ5LmRheSA9PT0gZGF5ICYmIGxhdW5kcnkuaG91ciA9PT0gaG91clxuICAgICAgICB9KVxuXG4gICAgICAgIGlmIChhbW91bnRPZkxhdW5kcmllcy5sZW5ndGggPT09IDAgfHwgYW1vdW50T2ZMYXVuZHJpZXMubGVuZ3RoIDwgY29ob3VzaW5nLmxhdW5kcnlOdW0pIHtcblxuICAgICAgICAgICAgaWYgKCFjb2hvdXNpbmcubGF1bmRyeS5zb21lKCh7IHVzZXI6IF91c2VyIH0pID0+IF91c2VyLnRvU3RyaW5nKCkgPT09IHVzZXJJZCkpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBDb2hvdXNpbmcuZmluZE9uZUFuZFVwZGF0ZSh7ICdtZW1iZXJzJzogdXNlcklkIH0sIHsgJGFkZFRvU2V0OiB7IGxhdW5kcnk6IHsgZGF5LCBob3VyLCB1c2VyOiB1c2VySWQgfSB9IH0pXG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IER1cGxpY2l0eUVycm9yKGBZb3UgYWxyZWFkeSBoYXZlIGEgcmVzZXJ2YXRpb24sIGNhbiBvbmx5IGRvIG9uZWApXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRHVwbGljaXR5RXJyb3IoJ3NvcnJ5IGFsbCB0aGUgd2FzaGluZyBtYWNoaW5lcyBhcmUgZnVsbCAnKVxuICAgICAgICB9XG5cbiAgICB9KSgpXG59Il19