function cov_1cszuzm5n2(){var path="/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/authenticate-user.js";var hash="854d781afd34d9e8014aac902307a55053e268b8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/authenticate-user.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:44}},"1":{start:{line:2,column:29},end:{line:2,column:53}},"2":{start:{line:3,column:77},end:{line:3,column:104}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:6,column:0},end:{line:22,column:1}},"5":{start:{line:7,column:4},end:{line:7,column:34}},"6":{start:{line:8,column:4},end:{line:8,column:25}},"7":{start:{line:9,column:4},end:{line:9,column:37}},"8":{start:{line:11,column:4},end:{line:21,column:10}},"9":{start:{line:13,column:12},end:{line:13,column:93}},"10":{start:{line:13,column:23},end:{line:13,column:93}},"11":{start:{line:15,column:12},end:{line:20,column:18}},"12":{start:{line:17,column:20},end:{line:17,column:76}},"13":{start:{line:17,column:32},end:{line:17,column:76}},"14":{start:{line:19,column:20},end:{line:19,column:34}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:38},end:{line:22,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:12,column:14},end:{line:12,column:15}},loc:{start:{line:12,column:22},end:{line:21,column:9}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:16,column:22},end:{line:16,column:23}},loc:{start:{line:16,column:31},end:{line:20,column:17}},line:16}},branchMap:{"0":{loc:{start:{line:13,column:12},end:{line:13,column:93}},type:"if",locations:[{start:{line:13,column:12},end:{line:13,column:93}},{start:{line:13,column:12},end:{line:13,column:93}}],line:13},"1":{loc:{start:{line:17,column:20},end:{line:17,column:76}},type:"if",locations:[{start:{line:17,column:20},end:{line:17,column:76}},{start:{line:17,column:20},end:{line:17,column:76}}],line:17}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"854d781afd34d9e8014aac902307a55053e268b8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1cszuzm5n2=function(){return actualCoverage;};}return actualCoverage;}cov_1cszuzm5n2();cov_1cszuzm5n2().s[0]++;require('coohappy-commons/polyfills/string');const{models:{User}}=(cov_1cszuzm5n2().s[1]++,require('coohappy-data'));const{utils:{Email},errors:{UnexistenceError,CredentialsError}}=(cov_1cszuzm5n2().s[2]++,require('coohappy-commons'));const bcrypt=(cov_1cszuzm5n2().s[3]++,require('bcryptjs'));cov_1cszuzm5n2().s[4]++;module.exports=(email,password)=>{cov_1cszuzm5n2().f[0]++;cov_1cszuzm5n2().s[5]++;String.validate.notVoid(email);cov_1cszuzm5n2().s[6]++;Email.validate(email);cov_1cszuzm5n2().s[7]++;String.validate.notVoid(password);cov_1cszuzm5n2().s[8]++;return User.findOne({email}).then(user=>{cov_1cszuzm5n2().f[1]++;cov_1cszuzm5n2().s[9]++;if(!user){cov_1cszuzm5n2().b[0][0]++;cov_1cszuzm5n2().s[10]++;throw new UnexistenceError(`User with e-mail ${email} does not exist`);}else{cov_1cszuzm5n2().b[0][1]++;}cov_1cszuzm5n2().s[11]++;return bcrypt.compare(password,user.password).then(match=>{cov_1cszuzm5n2().f[2]++;cov_1cszuzm5n2().s[12]++;if(!match){cov_1cszuzm5n2().b[1][0]++;cov_1cszuzm5n2().s[13]++;throw new CredentialsError('Wrong password');}else{cov_1cszuzm5n2().b[1][1]++;}cov_1cszuzm5n2().s[14]++;return user.id;});});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0ZS11c2VyLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJtb2RlbHMiLCJVc2VyIiwidXRpbHMiLCJFbWFpbCIsImVycm9ycyIsIlVuZXhpc3RlbmNlRXJyb3IiLCJDcmVkZW50aWFsc0Vycm9yIiwiYmNyeXB0IiwibW9kdWxlIiwiZXhwb3J0cyIsImVtYWlsIiwicGFzc3dvcmQiLCJTdHJpbmciLCJ2YWxpZGF0ZSIsIm5vdFZvaWQiLCJmaW5kT25lIiwidGhlbiIsInVzZXIiLCJjb21wYXJlIiwibWF0Y2giLCJpZCJdLCJtYXBwaW5ncyI6Im05RUFlWTttSEFmWkEsT0FBTyxDQUFDLG1DQUFELENBQVAsQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVYsMkJBQXVCRixPQUFPLENBQUMsZUFBRCxDQUE5QixDQUFOLENBQ0EsS0FBTSxDQUFFRyxLQUFLLENBQUUsQ0FBRUMsS0FBRixDQUFULENBQW9CQyxNQUFNLENBQUUsQ0FBRUMsZ0JBQUYsQ0FBb0JDLGdCQUFwQixDQUE1QiwyQkFBdUVQLE9BQU8sQ0FBQyxrQkFBRCxDQUE5RSxDQUFOLENBQ0EsS0FBTVEsQ0FBQUEsTUFBTSwwQkFBR1IsT0FBTyxDQUFDLFVBQUQsQ0FBVixDQUFaLEMsd0JBRUFTLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxLQUFELENBQVFDLFFBQVIsR0FBcUIsaURBQ2xDQyxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSixLQUF4QixFQURrQyx3QkFFbENQLEtBQUssQ0FBQ1UsUUFBTixDQUFlSCxLQUFmLEVBRmtDLHdCQUdsQ0UsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkgsUUFBeEIsRUFIa0Msd0JBS2xDLE1BQU9WLENBQUFBLElBQUksQ0FBQ2MsT0FBTCxDQUFhLENBQUVMLEtBQUYsQ0FBYixFQUNGTSxJQURFLENBQ0dDLElBQUksRUFBSSxpREFDVixHQUFJLENBQUNBLElBQUwsQ0FBVywwREFBTSxJQUFJWixDQUFBQSxnQkFBSixDQUFzQixvQkFBbUJLLEtBQU0saUJBQS9DLENBQU4sQ0FBc0UsQ0FBakYsaUNBRFUseUJBR1YsTUFBT0gsQ0FBQUEsTUFBTSxDQUFDVyxPQUFQLENBQWVQLFFBQWYsQ0FBeUJNLElBQUksQ0FBQ04sUUFBOUIsRUFDRkssSUFERSxDQUNHRyxLQUFLLEVBQUksa0RBQ1gsR0FBSSxDQUFDQSxLQUFMLENBQVksMERBQU0sSUFBSWIsQ0FBQUEsZ0JBQUosQ0FBcUIsZ0JBQXJCLENBQU4sQ0FBNEMsQ0FBeEQsaUNBRFcseUJBR1gsTUFBT1csQ0FBQUEsSUFBSSxDQUFDRyxFQUFaLENBQ0gsQ0FMRSxDQUFQLENBTUgsQ0FWRSxDQUFQLENBV0gsQ0FoQkQiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdjb29oYXBweS1jb21tb25zL3BvbHlmaWxscy9zdHJpbmcnKVxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciB9IH0gPSByZXF1aXJlKCdjb29oYXBweS1kYXRhJylcbmNvbnN0IHsgdXRpbHM6IHsgRW1haWwgfSwgZXJyb3JzOiB7IFVuZXhpc3RlbmNlRXJyb3IsIENyZWRlbnRpYWxzRXJyb3IgfSB9ID0gcmVxdWlyZSgnY29vaGFwcHktY29tbW9ucycpXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpXG5cbm1vZHVsZS5leHBvcnRzID0gKGVtYWlsLCBwYXNzd29yZCkgPT4ge1xuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKGVtYWlsKVxuICAgIEVtYWlsLnZhbGlkYXRlKGVtYWlsKVxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKHBhc3N3b3JkKVxuXG4gICAgcmV0dXJuIFVzZXIuZmluZE9uZSh7IGVtYWlsIH0pXG4gICAgICAgIC50aGVuKHVzZXIgPT4ge1xuICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgVW5leGlzdGVuY2VFcnJvcihgVXNlciB3aXRoIGUtbWFpbCAke2VtYWlsfSBkb2VzIG5vdCBleGlzdGApXG5cbiAgICAgICAgICAgIHJldHVybiBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlci5wYXNzd29yZClcbiAgICAgICAgICAgICAgICAudGhlbihtYXRjaCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbWF0Y2gpIHRocm93IG5ldyBDcmVkZW50aWFsc0Vycm9yKCdXcm9uZyBwYXNzd29yZCcpXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXIuaWRcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KVxufSAiXX0=