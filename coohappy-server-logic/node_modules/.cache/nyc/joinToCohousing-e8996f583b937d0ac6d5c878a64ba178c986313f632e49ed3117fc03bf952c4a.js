function cov_2o0lb8ua0d(){var path="/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/joinToCohousing.js";var hash="fa45bf2e10ae31f5c287fe1822093234272cc323";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/joinToCohousing.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:44}},"1":{start:{line:2,column:0},end:{line:2,column:42}},"2":{start:{line:3,column:57},end:{line:3,column:84}},"3":{start:{line:4,column:40},end:{line:4,column:64}},"4":{start:{line:5,column:35},end:{line:5,column:59}},"5":{start:{line:6,column:15},end:{line:6,column:34}},"6":{start:{line:9,column:0},end:{line:31,column:1}},"7":{start:{line:11,column:4},end:{line:11,column:35}},"8":{start:{line:12,column:4},end:{line:12,column:39}},"9":{start:{line:14,column:4},end:{line:30,column:8}},"10":{start:{line:16,column:21},end:{line:16,column:48}},"11":{start:{line:17,column:8},end:{line:17,column:86}},"12":{start:{line:17,column:19},end:{line:17,column:86}},"13":{start:{line:19,column:27},end:{line:19,column:83}},"14":{start:{line:20,column:8},end:{line:20,column:105}},"15":{start:{line:20,column:24},end:{line:20,column:105}},"16":{start:{line:22,column:26},end:{line:22,column:77}},"17":{start:{line:23,column:8},end:{line:23,column:109}},"18":{start:{line:23,column:23},end:{line:23,column:109}},"19":{start:{line:24,column:8},end:{line:27,column:10}},"20":{start:{line:29,column:8},end:{line:29,column:15}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:17},end:{line:9,column:18}},loc:{start:{line:9,column:41},end:{line:31,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:12},end:{line:14,column:13}},loc:{start:{line:14,column:24},end:{line:30,column:5}},line:14}},branchMap:{"0":{loc:{start:{line:17,column:8},end:{line:17,column:86}},type:"if",locations:[{start:{line:17,column:8},end:{line:17,column:86}},{start:{line:17,column:8},end:{line:17,column:86}}],line:17},"1":{loc:{start:{line:20,column:8},end:{line:20,column:105}},type:"if",locations:[{start:{line:20,column:8},end:{line:20,column:105}},{start:{line:20,column:8},end:{line:20,column:105}}],line:20},"2":{loc:{start:{line:23,column:8},end:{line:23,column:109}},type:"if",locations:[{start:{line:23,column:8},end:{line:23,column:109}},{start:{line:23,column:8},end:{line:23,column:109}}],line:23}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fa45bf2e10ae31f5c287fe1822093234272cc323"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2o0lb8ua0d=function(){return actualCoverage;};}return actualCoverage;}cov_2o0lb8ua0d();cov_2o0lb8ua0d().s[0]++;require('coohappy-commons/polyfills/string');cov_2o0lb8ua0d().s[1]++;require('coohappy-commons/polyfills/json');const{errors:{DuplicityError,UnexistenceError}}=(cov_2o0lb8ua0d().s[2]++,require('coohappy-commons'));const{models:{User,Cohousing}}=(cov_2o0lb8ua0d().s[3]++,require('coohappy-data'));const{mongoose:{ObjectId}}=(cov_2o0lb8ua0d().s[4]++,require('coohappy-data'));const bcrypt=(cov_2o0lb8ua0d().s[5]++,require('bcryptjs'));cov_2o0lb8ua0d().s[6]++;module.exports=(userId,accessCode)=>{cov_2o0lb8ua0d().f[0]++;cov_2o0lb8ua0d().s[7]++;String.validate.notVoid(userId);cov_2o0lb8ua0d().s[8]++;String.validate.notVoid(accessCode);cov_2o0lb8ua0d().s[9]++;return(async()=>{cov_2o0lb8ua0d().f[1]++;const user=(cov_2o0lb8ua0d().s[10]++,await User.findById(userId));cov_2o0lb8ua0d().s[11]++;if(!user){cov_2o0lb8ua0d().b[0][0]++;cov_2o0lb8ua0d().s[12]++;throw new UnexistenceError(`User with id ${userId} does not exist`);}else{cov_2o0lb8ua0d().b[0][1]++;}const _cohousing=(cov_2o0lb8ua0d().s[13]++,await Cohousing.findOne({'members':ObjectId(userId)}));cov_2o0lb8ua0d().s[14]++;if(_cohousing){cov_2o0lb8ua0d().b[1][0]++;cov_2o0lb8ua0d().s[15]++;throw new DuplicityError(`User with id ${userId} already belongs to a cohousing`);}else{cov_2o0lb8ua0d().b[1][1]++;}const cohousing=(cov_2o0lb8ua0d().s[16]++,await Cohousing.findOne({accessCode:accessCode}));cov_2o0lb8ua0d().s[17]++;if(!cohousing){cov_2o0lb8ua0d().b[2][0]++;cov_2o0lb8ua0d().s[18]++;throw new UnexistenceError(`cohousing with access code ${accessCode} does not exist `);}else{cov_2o0lb8ua0d().b[2][1]++;}cov_2o0lb8ua0d().s[19]++;await Promise.all([Cohousing.findByIdAndUpdate(cohousing.id,{$addToSet:{members:userId}}),User.findByIdAndUpdate(userId,{$set:{cohousing:cohousing._id}})]);cov_2o0lb8ua0d().s[20]++;return;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpvaW5Ub0NvaG91c2luZy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiZXJyb3JzIiwiRHVwbGljaXR5RXJyb3IiLCJVbmV4aXN0ZW5jZUVycm9yIiwibW9kZWxzIiwiVXNlciIsIkNvaG91c2luZyIsIm1vbmdvb3NlIiwiT2JqZWN0SWQiLCJiY3J5cHQiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwiYWNjZXNzQ29kZSIsIlN0cmluZyIsInZhbGlkYXRlIiwibm90Vm9pZCIsInVzZXIiLCJmaW5kQnlJZCIsIl9jb2hvdXNpbmciLCJmaW5kT25lIiwiY29ob3VzaW5nIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkQW5kVXBkYXRlIiwiaWQiLCIkYWRkVG9TZXQiLCJtZW1iZXJzIiwiJHNldCIsIl9pZCJdLCJtYXBwaW5ncyI6IiszRkFlWTttSEFmWkEsT0FBTyxDQUFDLG1DQUFELENBQVAsQyx3QkFDQUEsT0FBTyxDQUFDLGlDQUFELENBQVAsQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxjQUFGLENBQWtCQyxnQkFBbEIsQ0FBViwyQkFBbURILE9BQU8sQ0FBQyxrQkFBRCxDQUExRCxDQUFOLENBQ0EsS0FBTSxDQUFFSSxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFRQyxTQUFSLENBQVYsMkJBQWtDTixPQUFPLENBQUMsZUFBRCxDQUF6QyxDQUFOLENBQ0EsS0FBTSxDQUFFTyxRQUFRLENBQUUsQ0FBRUMsUUFBRixDQUFaLDJCQUE2QlIsT0FBTyxDQUFDLGVBQUQsQ0FBcEMsQ0FBTixDQUNBLEtBQU1TLENBQUFBLE1BQU0sMEJBQUdULE9BQU8sQ0FBQyxVQUFELENBQVYsQ0FBWixDLHdCQUdBVSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsTUFBRCxDQUFTQyxVQUFULEdBQXdCLGlEQUVyQ0MsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxPQUFoQixDQUF3QkosTUFBeEIsRUFGcUMsd0JBR3JDRSxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSCxVQUF4QixFQUhxQyx3QkFLckMsTUFBTyxDQUFDLFNBQVkseUJBRWhCLEtBQU1JLENBQUFBLElBQUksMkJBQUcsS0FBTVosQ0FBQUEsSUFBSSxDQUFDYSxRQUFMLENBQWNOLE1BQWQsQ0FBVCxDQUFWLENBRmdCLHlCQUdoQixHQUFJLENBQUNLLElBQUwsQ0FBVywwREFBTSxJQUFJZCxDQUFBQSxnQkFBSixDQUFzQixnQkFBZVMsTUFBTyxpQkFBNUMsQ0FBTixDQUFtRSxDQUE5RSxpQ0FFQSxLQUFNTyxDQUFBQSxVQUFVLDJCQUFHLEtBQU1iLENBQUFBLFNBQVMsQ0FBQ2MsT0FBVixDQUFrQixDQUFFLFVBQVdaLFFBQVEsQ0FBQ0ksTUFBRCxDQUFyQixDQUFsQixDQUFULENBQWhCLENBTGdCLHlCQU1oQixHQUFJTyxVQUFKLENBQWdCLDBEQUFNLElBQUlqQixDQUFBQSxjQUFKLENBQW9CLGdCQUFlVSxNQUFPLGlDQUExQyxDQUFOLENBQWlGLENBQWpHLGlDQUVBLEtBQU1TLENBQUFBLFNBQVMsMkJBQUcsS0FBTWYsQ0FBQUEsU0FBUyxDQUFDYyxPQUFWLENBQWtCLENBQUVQLFVBQVUsQ0FBRUEsVUFBZCxDQUFsQixDQUFULENBQWYsQ0FSZ0IseUJBU2hCLEdBQUcsQ0FBQ1EsU0FBSixDQUFlLDBEQUFNLElBQUlsQixDQUFBQSxnQkFBSixDQUFzQiw4QkFBNkJVLFVBQVcsa0JBQTlELENBQU4sQ0FBc0YsQ0FBckcsaUNBVGdCLHlCQVVoQixLQUFNUyxDQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxDQUNkakIsU0FBUyxDQUFDa0IsaUJBQVYsQ0FBNEJILFNBQVMsQ0FBQ0ksRUFBdEMsQ0FBMEMsQ0FBRUMsU0FBUyxDQUFFLENBQUVDLE9BQU8sQ0FBRWYsTUFBWCxDQUFiLENBQTFDLENBRGMsQ0FFZFAsSUFBSSxDQUFDbUIsaUJBQUwsQ0FBdUJaLE1BQXZCLENBQStCLENBQUVnQixJQUFJLENBQUUsQ0FBRVAsU0FBUyxDQUFFQSxTQUFTLENBQUNRLEdBQXZCLENBQVIsQ0FBL0IsQ0FGYyxDQUFaLENBQU4sQ0FWZ0IseUJBZWhCLE9BQ0gsQ0FoQk0sR0FBUCxDQWlCSCxDQXRCRCIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMvcG9seWZpbGxzL3N0cmluZycpXG5yZXF1aXJlKCdjb29oYXBweS1jb21tb25zL3BvbHlmaWxscy9qc29uJylcbmNvbnN0IHsgZXJyb3JzOiB7IER1cGxpY2l0eUVycm9yLCBVbmV4aXN0ZW5jZUVycm9yIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMnKVxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciwgQ29ob3VzaW5nIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWRhdGEnKVxuY29uc3QgeyBtb25nb29zZTogeyBPYmplY3RJZCB9IH0gPSByZXF1aXJlKCdjb29oYXBweS1kYXRhJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcblxuXG5tb2R1bGUuZXhwb3J0cyA9ICh1c2VySWQsIGFjY2Vzc0NvZGUpID0+IHtcblxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKHVzZXJJZClcbiAgICBTdHJpbmcudmFsaWRhdGUubm90Vm9pZChhY2Nlc3NDb2RlKVxuXG4gICAgcmV0dXJuIChhc3luYyAoKSA9PiB7XG5cbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlcklkKVxuICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBVbmV4aXN0ZW5jZUVycm9yKGBVc2VyIHdpdGggaWQgJHt1c2VySWR9IGRvZXMgbm90IGV4aXN0YClcbiAgICAgICBcbiAgICAgICAgY29uc3QgX2NvaG91c2luZyA9IGF3YWl0IENvaG91c2luZy5maW5kT25lKHsgJ21lbWJlcnMnOiBPYmplY3RJZCh1c2VySWQpIH0pXG4gICAgICAgIGlmIChfY29ob3VzaW5nKSB0aHJvdyBuZXcgRHVwbGljaXR5RXJyb3IoYFVzZXIgd2l0aCBpZCAke3VzZXJJZH0gYWxyZWFkeSBiZWxvbmdzIHRvIGEgY29ob3VzaW5nYClcblxuICAgICAgICBjb25zdCBjb2hvdXNpbmcgPSBhd2FpdCBDb2hvdXNpbmcuZmluZE9uZSh7IGFjY2Vzc0NvZGU6IGFjY2Vzc0NvZGUgfSlcbiAgICAgICAgaWYoIWNvaG91c2luZykgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYGNvaG91c2luZyB3aXRoIGFjY2VzcyBjb2RlICR7YWNjZXNzQ29kZX0gZG9lcyBub3QgZXhpc3QgYClcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgQ29ob3VzaW5nLmZpbmRCeUlkQW5kVXBkYXRlKGNvaG91c2luZy5pZCwgeyAkYWRkVG9TZXQ6IHsgbWVtYmVyczogdXNlcklkIH0gfSksXG4gICAgICAgICAgICBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKHVzZXJJZCwgeyAkc2V0OiB7IGNvaG91c2luZzogY29ob3VzaW5nLl9pZCB9IH0pXG4gICAgICAgIF0pXG5cbiAgICAgICAgcmV0dXJuO1xuICAgIH0pKClcbn0iXX0=