function cov_2o0lb8ua0d(){var path="/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/joinToCohousing.js";var hash="8acafab237bcfeb8b2e1e972ce20060990992e04";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/mac/bootcamp/collab/skylab-bootcamp-202004/staff/sergi-ramos/coohappy/coohappy-server-logic/joinToCohousing.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:44}},"1":{start:{line:2,column:0},end:{line:2,column:42}},"2":{start:{line:3,column:57},end:{line:3,column:84}},"3":{start:{line:4,column:40},end:{line:4,column:64}},"4":{start:{line:5,column:35},end:{line:5,column:59}},"5":{start:{line:6,column:15},end:{line:6,column:34}},"6":{start:{line:9,column:0},end:{line:28,column:1}},"7":{start:{line:11,column:4},end:{line:11,column:35}},"8":{start:{line:12,column:4},end:{line:12,column:39}},"9":{start:{line:14,column:4},end:{line:27,column:8}},"10":{start:{line:16,column:21},end:{line:16,column:48}},"11":{start:{line:17,column:8},end:{line:17,column:86}},"12":{start:{line:17,column:19},end:{line:17,column:86}},"13":{start:{line:19,column:27},end:{line:19,column:83}},"14":{start:{line:20,column:8},end:{line:20,column:105}},"15":{start:{line:20,column:24},end:{line:20,column:105}},"16":{start:{line:22,column:26},end:{line:22,column:77}},"17":{start:{line:23,column:8},end:{line:23,column:109}},"18":{start:{line:23,column:23},end:{line:23,column:109}},"19":{start:{line:24,column:8},end:{line:24,column:38}},"20":{start:{line:26,column:8},end:{line:26,column:37}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:17},end:{line:9,column:18}},loc:{start:{line:9,column:41},end:{line:28,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:12},end:{line:14,column:13}},loc:{start:{line:14,column:24},end:{line:27,column:5}},line:14}},branchMap:{"0":{loc:{start:{line:17,column:8},end:{line:17,column:86}},type:"if",locations:[{start:{line:17,column:8},end:{line:17,column:86}},{start:{line:17,column:8},end:{line:17,column:86}}],line:17},"1":{loc:{start:{line:20,column:8},end:{line:20,column:105}},type:"if",locations:[{start:{line:20,column:8},end:{line:20,column:105}},{start:{line:20,column:8},end:{line:20,column:105}}],line:20},"2":{loc:{start:{line:23,column:8},end:{line:23,column:109}},type:"if",locations:[{start:{line:23,column:8},end:{line:23,column:109}},{start:{line:23,column:8},end:{line:23,column:109}}],line:23}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8acafab237bcfeb8b2e1e972ce20060990992e04"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2o0lb8ua0d=function(){return actualCoverage;};}return actualCoverage;}cov_2o0lb8ua0d();cov_2o0lb8ua0d().s[0]++;require('coohappy-commons/polyfills/string');cov_2o0lb8ua0d().s[1]++;require('coohappy-commons/polyfills/json');const{errors:{DuplicityError,UnexistenceError}}=(cov_2o0lb8ua0d().s[2]++,require('coohappy-commons'));const{models:{User,Cohousing}}=(cov_2o0lb8ua0d().s[3]++,require('coohappy-data'));const{mongoose:{ObjectId}}=(cov_2o0lb8ua0d().s[4]++,require('coohappy-data'));const bcrypt=(cov_2o0lb8ua0d().s[5]++,require('bcryptjs'));cov_2o0lb8ua0d().s[6]++;module.exports=(userId,accessCode)=>{cov_2o0lb8ua0d().f[0]++;cov_2o0lb8ua0d().s[7]++;String.validate.notVoid(userId);cov_2o0lb8ua0d().s[8]++;String.validate.notVoid(accessCode);cov_2o0lb8ua0d().s[9]++;return(async()=>{cov_2o0lb8ua0d().f[1]++;const user=(cov_2o0lb8ua0d().s[10]++,await User.findById(userId));cov_2o0lb8ua0d().s[11]++;if(!user){cov_2o0lb8ua0d().b[0][0]++;cov_2o0lb8ua0d().s[12]++;throw new UnexistenceError(`User with id ${userId} does not exist`);}else{cov_2o0lb8ua0d().b[0][1]++;}const _cohousing=(cov_2o0lb8ua0d().s[13]++,await Cohousing.findOne({'members':ObjectId(userId)}));cov_2o0lb8ua0d().s[14]++;if(_cohousing){cov_2o0lb8ua0d().b[1][0]++;cov_2o0lb8ua0d().s[15]++;throw new DuplicityError(`User with id ${userId} already belongs to a cohousing`);}else{cov_2o0lb8ua0d().b[1][1]++;}const cohousing=(cov_2o0lb8ua0d().s[16]++,await Cohousing.findOne({accessCode:accessCode}));cov_2o0lb8ua0d().s[17]++;if(!cohousing){cov_2o0lb8ua0d().b[2][0]++;cov_2o0lb8ua0d().s[18]++;throw new UnexistenceError(`cohousing with access code ${accessCode} does not exist `);}else{cov_2o0lb8ua0d().b[2][1]++;}cov_2o0lb8ua0d().s[19]++;cohousing.members.push(userId);cov_2o0lb8ua0d().s[20]++;return await cohousing.save();})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpvaW5Ub0NvaG91c2luZy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiZXJyb3JzIiwiRHVwbGljaXR5RXJyb3IiLCJVbmV4aXN0ZW5jZUVycm9yIiwibW9kZWxzIiwiVXNlciIsIkNvaG91c2luZyIsIm1vbmdvb3NlIiwiT2JqZWN0SWQiLCJiY3J5cHQiLCJtb2R1bGUiLCJleHBvcnRzIiwidXNlcklkIiwiYWNjZXNzQ29kZSIsIlN0cmluZyIsInZhbGlkYXRlIiwibm90Vm9pZCIsInVzZXIiLCJmaW5kQnlJZCIsIl9jb2hvdXNpbmciLCJmaW5kT25lIiwiY29ob3VzaW5nIiwibWVtYmVycyIsInB1c2giLCJzYXZlIl0sIm1hcHBpbmdzIjoiKzNGQWVZO21IQWZaQSxPQUFPLENBQUMsbUNBQUQsQ0FBUCxDLHdCQUNBQSxPQUFPLENBQUMsaUNBQUQsQ0FBUCxDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLGNBQUYsQ0FBa0JDLGdCQUFsQixDQUFWLDJCQUFtREgsT0FBTyxDQUFDLGtCQUFELENBQTFELENBQU4sQ0FDQSxLQUFNLENBQUVJLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVFDLFNBQVIsQ0FBViwyQkFBa0NOLE9BQU8sQ0FBQyxlQUFELENBQXpDLENBQU4sQ0FDQSxLQUFNLENBQUVPLFFBQVEsQ0FBRSxDQUFFQyxRQUFGLENBQVosMkJBQTZCUixPQUFPLENBQUMsZUFBRCxDQUFwQyxDQUFOLENBQ0EsS0FBTVMsQ0FBQUEsTUFBTSwwQkFBR1QsT0FBTyxDQUFDLFVBQUQsQ0FBVixDQUFaLEMsd0JBR0FVLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUFDQyxNQUFELENBQVNDLFVBQVQsR0FBd0IsaURBRXJDQyxNQUFNLENBQUNDLFFBQVAsQ0FBZ0JDLE9BQWhCLENBQXdCSixNQUF4QixFQUZxQyx3QkFHckNFLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkMsT0FBaEIsQ0FBd0JILFVBQXhCLEVBSHFDLHdCQUtyQyxNQUFPLENBQUMsU0FBWSx5QkFFaEIsS0FBTUksQ0FBQUEsSUFBSSwyQkFBRyxLQUFNWixDQUFBQSxJQUFJLENBQUNhLFFBQUwsQ0FBY04sTUFBZCxDQUFULENBQVYsQ0FGZ0IseUJBR2hCLEdBQUksQ0FBQ0ssSUFBTCxDQUFXLDBEQUFNLElBQUlkLENBQUFBLGdCQUFKLENBQXNCLGdCQUFlUyxNQUFPLGlCQUE1QyxDQUFOLENBQW1FLENBQTlFLGlDQUVBLEtBQU1PLENBQUFBLFVBQVUsMkJBQUcsS0FBTWIsQ0FBQUEsU0FBUyxDQUFDYyxPQUFWLENBQWtCLENBQUUsVUFBV1osUUFBUSxDQUFDSSxNQUFELENBQXJCLENBQWxCLENBQVQsQ0FBaEIsQ0FMZ0IseUJBTWhCLEdBQUlPLFVBQUosQ0FBZ0IsMERBQU0sSUFBSWpCLENBQUFBLGNBQUosQ0FBb0IsZ0JBQWVVLE1BQU8saUNBQTFDLENBQU4sQ0FBaUYsQ0FBakcsaUNBRUEsS0FBTVMsQ0FBQUEsU0FBUywyQkFBRyxLQUFNZixDQUFBQSxTQUFTLENBQUNjLE9BQVYsQ0FBa0IsQ0FBRVAsVUFBVSxDQUFFQSxVQUFkLENBQWxCLENBQVQsQ0FBZixDQVJnQix5QkFTaEIsR0FBRyxDQUFDUSxTQUFKLENBQWUsMERBQU0sSUFBSWxCLENBQUFBLGdCQUFKLENBQXNCLDhCQUE2QlUsVUFBVyxrQkFBOUQsQ0FBTixDQUFzRixDQUFyRyxpQ0FUZ0IseUJBVWhCUSxTQUFTLENBQUNDLE9BQVYsQ0FBa0JDLElBQWxCLENBQXVCWCxNQUF2QixFQVZnQix5QkFZaEIsTUFBTyxNQUFNUyxDQUFBQSxTQUFTLENBQUNHLElBQVYsRUFBYixDQUNILENBYk0sR0FBUCxDQWNILENBbkJEIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnY29vaGFwcHktY29tbW9ucy9wb2x5ZmlsbHMvc3RyaW5nJylcbnJlcXVpcmUoJ2Nvb2hhcHB5LWNvbW1vbnMvcG9seWZpbGxzL2pzb24nKVxuY29uc3QgeyBlcnJvcnM6IHsgRHVwbGljaXR5RXJyb3IsIFVuZXhpc3RlbmNlRXJyb3IgfSB9ID0gcmVxdWlyZSgnY29vaGFwcHktY29tbW9ucycpXG5jb25zdCB7IG1vZGVsczogeyBVc2VyLCBDb2hvdXNpbmcgfSB9ID0gcmVxdWlyZSgnY29vaGFwcHktZGF0YScpXG5jb25zdCB7IG1vbmdvb3NlOiB7IE9iamVjdElkIH0gfSA9IHJlcXVpcmUoJ2Nvb2hhcHB5LWRhdGEnKVxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKVxuXG5cbm1vZHVsZS5leHBvcnRzID0gKHVzZXJJZCwgYWNjZXNzQ29kZSkgPT4ge1xuXG4gICAgU3RyaW5nLnZhbGlkYXRlLm5vdFZvaWQodXNlcklkKVxuICAgIFN0cmluZy52YWxpZGF0ZS5ub3RWb2lkKGFjY2Vzc0NvZGUpXG5cbiAgICByZXR1cm4gKGFzeW5jICgpID0+IHtcblxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZCh1c2VySWQpXG4gICAgICAgIGlmICghdXNlcikgdGhyb3cgbmV3IFVuZXhpc3RlbmNlRXJyb3IoYFVzZXIgd2l0aCBpZCAke3VzZXJJZH0gZG9lcyBub3QgZXhpc3RgKVxuICAgICAgIFxuICAgICAgICBjb25zdCBfY29ob3VzaW5nID0gYXdhaXQgQ29ob3VzaW5nLmZpbmRPbmUoeyAnbWVtYmVycyc6IE9iamVjdElkKHVzZXJJZCkgfSlcbiAgICAgICAgaWYgKF9jb2hvdXNpbmcpIHRocm93IG5ldyBEdXBsaWNpdHlFcnJvcihgVXNlciB3aXRoIGlkICR7dXNlcklkfSBhbHJlYWR5IGJlbG9uZ3MgdG8gYSBjb2hvdXNpbmdgKVxuXG4gICAgICAgIGNvbnN0IGNvaG91c2luZyA9IGF3YWl0IENvaG91c2luZy5maW5kT25lKHsgYWNjZXNzQ29kZTogYWNjZXNzQ29kZSB9KVxuICAgICAgICBpZighY29ob3VzaW5nKSB0aHJvdyBuZXcgVW5leGlzdGVuY2VFcnJvcihgY29ob3VzaW5nIHdpdGggYWNjZXNzIGNvZGUgJHthY2Nlc3NDb2RlfSBkb2VzIG5vdCBleGlzdCBgKVxuICAgICAgICBjb2hvdXNpbmcubWVtYmVycy5wdXNoKHVzZXJJZClcblxuICAgICAgICByZXR1cm4gYXdhaXQgY29ob3VzaW5nLnNhdmUoKVxuICAgIH0pKClcbn0iXX0=